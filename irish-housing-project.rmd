---
title: "Irish Property Pricing Project"
author: "Fergal Stapleton, Amit Anchalia, Fiona Devaney, Colin Brian O'Flynn, Ramesh Suragam, Vishal Walia and John Dunne"
date: "4/20/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

### Abstract

The objective of this project is to analyse the housing market in Ireland from 2010 to 2019 with strong visualisations to support our analysis. We will also offer some prediction for 2020 through to 2022. In addtion we will conduct a more granular study of commuter and costal towns offering analysis of trends relating to this data. In the next section we will provide a general overview starting with a brief discussion about the recession, its effects and the aftermath.

### Overview

The global economic crash of 2008 had a profound effect on the housing market in Ireland.[2] Ireland was severly hit becomming the first european country to offically enter recession status in september of 2008 and which lasted well into 2013 and which effectively brought to an end to what is colloquially refered to as the 'Celtic Tiger', a period of economic growth that originated in the early 1990's.

```{r fig.width= 6, fig.height= 3, out.width= "50%", out.extra='style="float:right; padding:10px"', echo=FALSE}
knitr::include_graphics('./gif/ireland-choropleth-anim.gif')
```


One of the primary reasons the economy was so deeply effected was due to a property bubble which arose due to poor financial regulatory practices relating to lending and mortage policies by banks.[3]


To aid in our overview a Choropleth animation was created using data from the Ordinance Survey Ireland group.[4] The chloropleth animation shows the median property prices for each county for each year ranging from 2010 to 2019 (Fig. 1). A property in this context can mostly be defined as either an apartment or a house (see Data Cleansing section for detail). Pricing was ajusted for VAT. Starting in 2010 we can see a continued decline in median property prices country wide up until 2013. At this point property prices for 11 counties had a median price of 90K or less. After 2013 propety prices in general begin to recover increasing year on year for most counties. A point of note is Dublin which has the greatest increase in median price and from 2017 on the surrounding counties of Meath, Kildare and Wicklow had median prices above 210K. By the end of 2019 Galway and Cork also went above the median price of 210K.



In general property prices appear to be increasing and further detail will be given in the following sections



### Data Cleansing

### Analysis of Dublin Commuter Belt

The Dublin commuter belt was originally an area of land beyond the M50 motorway where people who worked in the city would buy homes which were more affordable than the properties in the inner city. The Dublin commuter belt initially comprised towns such as Lucan and Swords. However, since the height of the housing bubble in the early 2000’s the Dublin commuter belt began to spread into the adjoining counties of Kildare and Meath until it’s halt was eventually precipitated by the 2008 housing collapse. The heat map below shows the median house and apartment prices in the period from 2010 to 2019 in the counties of Kildare and Meath. The heat map is illustrative of the sharp fall in property prices that was witnessed in the years from 2011 until 2013 followed by a resurgence in property prices from mid 2014 onwards. Property prices grew strongly from 2014 where the median price was €193,000 until the end of 2019 where the median price had risen to €268,722 in the Kildare, Meath areas.[5] 

```{r echo=FALSE}
suppressMessages(library(tidyverse))
suppressMessages(library(ggplot2))
suppressMessages(library(plyr))
suppressMessages(library(GGally))
# Read in Data
country_data <- read.csv("data/PPR-ALL-CLEAN.csv")
kildare_data <- country_data[country_data$county == "kildare",]
meath_data <- country_data[country_data$county == "meath",]
house_clean <- rbind(kildare_data, meath_data)
house_clean <- house_clean[,-1]

names(house_clean) <- c("Date","Address","County","Price","Not Full Price","VAT Exclusive","Description","Year","Price_adj")
dates_orginal <- house_clean[,1]
dates_orginal <- strptime(as.character(dates_orginal), "%Y-%m-%d")
dates_orginal <- format(dates_orginal, "%d/%m/%Y")
house_clean[,1] <- as.character(house_clean[,1])

date_long <- substring(house_clean[,1],str_length(house_clean[,1])-9)

my_month <- as.numeric(substring( date_long,6, 7))

dayf <- as.numeric(substring(date_long,9, 10))

my_months <- c("Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec")

# Drop Postal Code
house_clean <- house_clean[,1:8]
house_clean <- house_clean[,c(1:2,4:8)]


house_clean <- mutate(house_clean,
                      monthf = my_months[my_month],
                      weekdayf = substring(weekdays(as.Date(dates_orginal, "%d/%m/%Y")),1,3),
                      monthweek =  1 + 
                      ceiling(as.numeric(difftime(as.Date(dates_orginal, "%d/%m/%Y"), 
                              as.Date(paste0(substr(as.Date(dates_orginal, "%d/%m/%Y"),1,8),'01')), units = "weeks")))
                              , week= monthweek
                      )

house_clean <- mutate(house_clean,
                      full_date = dates_orginal
                      )

house_clean <- house_clean[house_clean$Date < 2020,]
house_clean <- house_clean[house_clean$Price > 60000,]
house_clean <- house_clean[house_clean$Price < 1500000,]
median_prices <- ddply(house_clean, .(full_date), summarize, mean_Price_for_day = round(median(Price)/1000,0))

median_prices <- mutate(median_prices,
                        monthf = substring(months(as.Date(median_prices$full_date)),1,3),
                        weekdayf = substring(weekdays(as.Date(median_prices$full_date)),1,3),
                        monthweek =  1 + 
                        ceiling(as.numeric(difftime(as.Date(median_prices$full_date, "%d/%m/%Y"), 
                                as.Date(paste0(substr(as.Date(median_prices$full_date, "%d/%m/%Y"),1,8),'01')), units = "weeks")))
                        , week= monthweek,
                        Date = substring(as.character(median_prices$full_date),str_length(median_prices$full_date)- 3 )
                 
                        )
median_prices <- median_prices[(median_prices[,2] < 450) & (median_prices[,2] > 60) ,]


median_prices$monthf <- factor(median_prices$monthf,labels=c("Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"), ordered= T)



```

```{r, fig.width=9, fig.height= 6,eval=T, echo=FALSE}
 # Heat Map of Kildare and Meath house prices
ggplot(median_prices, aes(monthweek, weekdayf, fill = mean_Price_for_day )) + 
  geom_tile(colour = "white") + 
  facet_grid(Date~monthf ) + 
  scale_fill_gradient(low="yellow", high="red") +
  labs(x="Week of Month",
       y="",
       title = "Calendar Heatmap of Median Prices From 2010-2019", 
       subtitle="Commuter Belt - Kildare, Meath", 
       fill="Prices")+
  theme(
        #axis.text.y=element_blank(),
        #axis.ticks.y=element_blank(),
        axis.text.y = element_text(size=4.0)
        ) 

```




### References

[1] <primary-data-source> \
[2] https://en.wikipedia.org/wiki/Post-2008_Irish_economic_downturn \
[3] https://en.wikipedia.org/wiki/Celtic_Tiger \
[4] https://data.gov.ie/dataset/counties-osi-national-statutory-boundaries-generalised-20m/resource/b412ae22-ea13-4ca3-a8be-5ffc21f455f6 \
[5] https://www.irishtimes.com/business/economy/priced-out-home-buyers-drifting-to-dublin-s-commuter-belt-1.4104686